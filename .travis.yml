language: cpp
sudo: required
dist: bionic
cache:
  directories:
  - "${HOME}/.conan"
  - "${TRAVIS_BUILD_DIR}/cmake"
  - "${TRAVIS_BUILD_DIR}/arrayfire"
matrix:
  include:
  - os: linux
    dist: bionic
    sudo: required
    compiler:
    - gcc
    git:
      submodules: false
    before_install:
    - git submodule update --init
    - source .CI/travis/install_linux.sh
    - source .CI/travis/install-arrayfire_linux.sh
    - source .CI/travis/install-cmake_linux.sh
    script:
    - source .CI/travis/build_linux.sh
  - os: linux
    dist: bionic
    sudo: required
    compiler:
    - clang
    git:
      submodules: false
    before_install:
    - git submodule update --init
    - source .CI/travis/install_linux.sh
    - source .CI/travis/install-arrayfire_linux.sh
    - source .CI/travis/install-cmake_linux.sh
    script:
    - source .CI/travis/build_linux.sh
    before_deploy:
    - cpack
    - cpack -G DEB
    - cpack -G RPM
    - mv khiva.sh khiva-${TRAVIS_TAG}.sh
    deploy:
      name: "${TRAVIS_TAG} - Linux"
      body: "${TRAVIS_COMMIT_MESSAGE}"
      skip_cleanup: true
      provider: releases
      api_key:
        secure: QCph9x8rQG7ZUSZrRHnPSXMfe0vILSfT97oWrXOoXJGpOgFS0O3Pu/ODPfenhchOw3JvOwdgC7pUmQ3RaQO02iNzJTxStBhS0Sw8asYfHwFDnpsi+75L5K+8fqNn95RkKbQNAvhaHuefZAAloTJeirktvKGVtRemMnr8W6f28ilMEWv0Lc3moz9kP3QCGjREmTI3gKB5ccKydACIhLlB4g/FIB9IxRXjqSKyzUogOoxsmeJ7l+cE1UyKdjotcm+xs4e8YpWV7Laj7/Y29P1Yf9iLbZ7way+wDMUhd9fVeVMv+8+C4it8OySVWkGHewUpyz0SWwY/sZrmPqbGk1jhSAnZibgSx2xcOZjdsR3I6zewGW/XG1XfSFZpLbAqkaE3UrDpuzZQMgQd6aQlEthIB1j6bd8mer9W+w7Up22LcQ5RJzyCDszZBcirE0DAaoAz4LG31axX9ijNQzDem9zzsAmO6siD3XJYswFGL+mBa0g1+M2aobL/JVDSTgFteN5tsjiVW1IYswva3aJOTK3cyU697zZWN0rGZZkOgf4kuQmLGeyRnLMeSwcd3mS5OikTCq1NC0gpB+WSP5/rbZBM/ZXog0VnPzwpmcCdVEnqWwqpAtH51G2cGaZMbgMUfGqN0+Or35dm0TgvvuCGpkJIrnjkRSbcMlj5FZu4ZClrVo4=
      file_glob: true
      file:
      - "${TRAVIS_BUILD_DIR}/build/khiva-*.deb"
      - "${TRAVIS_BUILD_DIR}/build/khiva-*.rpm"
      - "${TRAVIS_BUILD_DIR}/build/khiva-${TRAVIS_TAG}.sh"
      draft: true
      prerelease: false
      on:
        tags: true
  - os: osx
    osx_image: xcode9.3
    compiler:
    - gcc
    env:
    - TRAVIS_PYTHON_VERSION=3.6.5
    cache:
      directories:
      - "${HOME}/.conan"
      - "${TRAVIS_BUILD_DIR}/cmake"
      - "${TRAVIS_BUILD_DIR}/arrayfire"
      - "$HOME/.pyenv"
      - "$HOME/Library/Caches/Homebrew"
    git:
      submodules: false
    before_install:
    - git submodule update --init
    - source .CI/travis/install_osx.sh
    - source .CI/travis/install-arrayfire_osx.sh
    script:
    - source .CI/travis/build_osx.sh
  - os: osx
    osx_image: xcode9.3
    compiler:
    - clang
    env:
    - TRAVIS_PYTHON_VERSION=3.6.5
    cache:
      directories:
      - "${HOME}/.conan"
      - "${TRAVIS_BUILD_DIR}/cmake"
      - "${TRAVIS_BUILD_DIR}/arrayfire"
      - "$HOME/.pyenv"
      - "$HOME/Library/Caches/Homebrew"
    git:
      submodules: false
    before_install:
    - git submodule update --init
    - source .CI/travis/install_osx.sh
    - source .CI/travis/install-arrayfire_osx.sh
    script:
    - source .CI/travis/build_osx.sh
    after_success:
    - cd ${TRAVIS_BUILD_DIR}
    - source .CI/travis/codecov.sh
    - cd ${TRAVIS_BUILD_DIR}
    before_deploy:
    - cd build
    - cpack -G productbuild
    deploy:
      name: "${TRAVIS_TAG} - MacOS"
      body: "${TRAVIS_COMMIT_MESSAGE}"
      skip_cleanup: true
      provider: releases
      api_key:
        secure: QCph9x8rQG7ZUSZrRHnPSXMfe0vILSfT97oWrXOoXJGpOgFS0O3Pu/ODPfenhchOw3JvOwdgC7pUmQ3RaQO02iNzJTxStBhS0Sw8asYfHwFDnpsi+75L5K+8fqNn95RkKbQNAvhaHuefZAAloTJeirktvKGVtRemMnr8W6f28ilMEWv0Lc3moz9kP3QCGjREmTI3gKB5ccKydACIhLlB4g/FIB9IxRXjqSKyzUogOoxsmeJ7l+cE1UyKdjotcm+xs4e8YpWV7Laj7/Y29P1Yf9iLbZ7way+wDMUhd9fVeVMv+8+C4it8OySVWkGHewUpyz0SWwY/sZrmPqbGk1jhSAnZibgSx2xcOZjdsR3I6zewGW/XG1XfSFZpLbAqkaE3UrDpuzZQMgQd6aQlEthIB1j6bd8mer9W+w7Up22LcQ5RJzyCDszZBcirE0DAaoAz4LG31axX9ijNQzDem9zzsAmO6siD3XJYswFGL+mBa0g1+M2aobL/JVDSTgFteN5tsjiVW1IYswva3aJOTK3cyU697zZWN0rGZZkOgf4kuQmLGeyRnLMeSwcd3mS5OikTCq1NC0gpB+WSP5/rbZBM/ZXog0VnPzwpmcCdVEnqWwqpAtH51G2cGaZMbgMUfGqN0+Or35dm0TgvvuCGpkJIrnjkRSbcMlj5FZu4ZClrVo4=
      file: "${TRAVIS_BUILD_DIR}/build/khiva-${TRAVIS_TAG}.pkg"
      draft: true
      prerelease: false
      on:
        tags: true
env:
  global:
    secure: H8sDB7V7gq9d2vWBayFWZ5quai1gG13Q1MvY91awNLOLTPM1HTKGqFSWA6psyhQvWndFdht/BXVV+P5ssczJRn1xbhVYSEvifLxV0e75insR6CvuvBW+jsJsZJnom0pYMviyLP9/S+bxXRK79DovMog0Nud2oQ3wbQjVP4pOQ3TuaZMCID9vvS6oA68AKbuCuz5qnuNCBKnC++Rp12tSiCH/NeKlTPpaJk/OPeL8T4ezLTvwVkM3cJx1/rbp7BS0LRMI4pvmrm7KN9QzbpLng8XaslSTUzmS7663Vo84H4rPFoRYxvmd9W3oP+m7my/dT68cojhWYIabZM0Tfyg/AcQJbdGHQEtYRrugwYZv7R/rrLt6tBkcxWyav2VcAIRWTeeb/NwIbBtkf+otVLWs5uewfNZycNI0BGsf20TlqXGJZtL2ZXCxqlktapvAl+2uO11EMGamRp5nxcnwLNADn+SjlRUMIsS4DIuUQwSxeszUdMmMGzAOcTJr4zG98yIcGCNP75Ej+A2YScc2ernZtM1853+hWXQC4t57Zhu/LYon2eETUyN8/CXoykP0oQ+KduE3/ep6O1OKM3VmOKhMtW2bNoB4ED0Gk8kfJhQcob9UBRFL49SRzNjw+TA68TxMk9Ni9H3ln3x4WAEYzkT7201t6G1GwEUN67xKFdVifSU=
