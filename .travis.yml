language: cpp
sudo: required
dist: trusty


cache:
    directories:
      - ${HOME}/.conan
      - /usr/local/Cellar

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: required
      compiler:
        - gcc
      before_install:
        - source .CI/travis/install_linux.sh
        - source .CI/travis/install-arrayfire.sh
        - source .CI/travis/install-cmake.sh
      script:
        - source .CI/travis/build_linux.sh

    - os: linux
      dist: trusty
      sudo: required
      compiler:
        - clang
      before_install:
        - source .CI/travis/install_linux.sh
        - source .CI/travis/install-arrayfire.sh
        - source .CI/travis/install-cmake.sh
      script:
        - source .CI/travis/build_linux.sh

    - os: osx
      osx_image: xcode9.3
      compiler:
        - gcc
      before_install:
        - source .CI/travis/install_osx.sh
        - source .CI/travis/install-arrayfire_osx.sh
      script:
        - source .CI/travis/build_osx.sh

    - os: osx
      osx_image: xcode9.3
      compiler:
        - clang
      before_install:
        - source .CI/travis/install_osx.sh
        - source .CI/travis/install-arrayfire_osx.sh
      script:
        - source .CI/travis/build_osx.sh

      after_success:
        - cd build
        - lcov --directory . --base-directory ../src/khiva --no-external --capture --output-file coverage.info
        - lcov --remove coverage.info '*/.conan/*' '*/usr*' '*/cl.hpp' '*/include/*' '*/bindings/*' '*/test/*' -o coverage.info
        - lcov --list coverage.info
        - bash <(curl -s https://codecov.io/bash) || echo "Codecov did not collect coverage reports"


